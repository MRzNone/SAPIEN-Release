from robot.python.demonstration.recorder_ros import Recorder
import sapyen_robot
import sys
import pickle
import numpy as np


def main():
    drawer_with_handle = ['19179', '19855', '19898', '20043', '20411', '20555', '20745', '20985', '22241', '22301',
                          '22339', '22367', '22508', '23372', '23511', '24644', '24931', '25144', '25308', '25913',
                          '26503', '26525', '26652', '26657', '26670', '26806', '27044', '27189', '27267', '28164',
                          '28668', '29525', '29921', '30238', '30341', '30666', '30739', '30857', '31249', '31601',
                          '32174', '32259', '32324', '32601', '32625', '32761', '32932', '33116', '33457', '33810',
                          '33930', '34178', '34610', '34617', '40147', '40417', '41083', '41510', '44781', '44817',
                          '44826', '44853', '44962', '45092', '45132', '45135', '45146', '45162', '45168', '45194',
                          '45219', '45235', '45238', '45243', '45261', '45271', '45290', '45374', '45427', '45575',
                          '45612', '45622', '45632', '45636', '45661', '45676', '45677', '45687', '45689', '45694',
                          '45710', '45746', '45756', '45759', '45784', '45790', '45801', '45841', '45940', '45948',
                          '45949', '45984', '46014', '46045', '46060', '46084', '46109', '46123', '46130', '46145',
                          '46172', '46180', '46230', '46236', '46334', '46380', '46440', '46443', '46452', '46462',
                          '46466', '46537', '46544', '46549', '46598', '46641', '46653', '46699', '46741', '46762',
                          '46839', '46856', '46859', '46874', '46893', '46981', '47024', '47089', '47178', '47183',
                          '47185', '47207', '47233', '47235', '47252', '47254', '47296', '47438', '47529', '47565',
                          '47570', '47578', '47585', '47648', '47711', '47926', '47944', '48010', '48051', '48063',
                          '48169', '48253', '48258', '48263', '48491', '48513', '48517', '48740', '48876', '48878',
                          '49140']

    partnet_id = "27189"
    print("*******************Partnet ID: {}".format(partnet_id))
    recorder = Recorder(partnet_id)
    data = {}
    try:
        while 1:
            recorder.step()
    finally:
        data.update({"control": np.stack(recorder.control_signal)})
        data.update({"state": np.stack(recorder.dump_data)})
        data.update({"robot_link_force": np.stack(recorder.robot_force_array),
                     "object_link_force": np.stack(recorder.object_force_array)})
        data.update({"header": recorder.generate_header()})
        save_file = "data/{}_v0.p".format(partnet_id)
        with open(save_file, 'wb') as f:
            pickle.dump(data, f)


if __name__ == '__main__':
    sapyen_robot.ros.init(sys.argv, "recorder")
    main()
