FROM quay.io/pypa/manylinux2014_x86_64
RUN yum update && mkdir /workspace

WORKDIR /workspace
COPY PhysX /workspace/PhysX

WORKDIR /workspace
RUN git clone --single-branch -b v5.0.1 --depth 1 https://github.com/assimp/assimp.git
WORKDIR /workspace/assimp
RUN mkdir /workspace/assimp/build
WORKDIR /workspace/assimp/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release -DASSIMP_BUILD_TESTS=OFF && make -j && make install

WORKDIR /workspace
RUN git clone --single-branch -b 20210000.6 --depth 1 https://github.com/coin-or/CppAD.git
WORKDIR /workspace/CppAD
RUN mkdir /workspace/CppAD/build
WORKDIR /workspace/CppAD/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release && make -j && make install

WORKDIR /workspace
RUN git clone --single-branch -b 0.3.2 --depth 1 https://github.com/ros/console_bridge.git
RUN mkdir /workspace/console_bridge/build
WORKDIR /workspace/console_bridge/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release && make -j && make install

WORKDIR /workspace
RUN git clone --single-branch -b 1.0.5 --depth 1 https://github.com/ros/urdfdom_headers.git
RUN mkdir /workspace/urdfdom_headers/build
WORKDIR /workspace/urdfdom_headers/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release && make -j && make install

WORKDIR /workspace
RUN yum install -y tinyxml-devel
RUN git clone --single-branch -b 1.0.4 --depth 1 https://github.com/ros/urdfdom.git
RUN mkdir /workspace/urdfdom/build
WORKDIR /workspace/urdfdom/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release && make -j && make install

WORKDIR /workspace
RUN yum install -y eigen3-devel urdfdom-devel boost-devel
RUN git clone --single-branch -b v2.5.6 --depth 1 https://github.com/stack-of-tasks/pinocchio.git
WORKDIR /workspace/pinocchio
RUN git submodule update --init --recursive && mkdir /workspace/pinocchio/build
WORKDIR /workspace/pinocchio/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTING=OFF -DBUILD_PYTHON_INTERFACE=OFF -DBUILD_WITH_AUTODIFF_SUPPORT=ON -DBUILD_WITH_URDF_SUPPORT=ON && make -j && make install

WORKDIR /workspace
RUN git clone --single-branch -b v1.8.2 --depth 1 https://github.com/gabime/spdlog.git
RUN mkdir /workspace/spdlog/build
WORKDIR /workspace/spdlog/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release -DSPDLOG_BUILD_EXAMPLE=OFF && make -j && make install

WORKDIR /workspace
RUN yum install -y libXrandr-devel libXinerama-devel libXcursor-devel libXi-devel
RUN git clone --single-branch -b 3.3.3 --depth 1 https://github.com/glfw/glfw.git
RUN mkdir /workspace/glfw/build
WORKDIR /workspace/glfw/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release -DGLFW_BUILD_DOCS=OFF -DGLFW_BUILD_EXAMPLES=OFF -DGLFW_BUILD_TESTS=OFF -DGLFW_VULKAN_STATIC=ON && make -j && make install

WORKDIR /workspace
RUN curl -O https://sdk.lunarg.com/sdk/download/1.2.170.0/linux/vulkan_sdk.tar.gz && tar -xf vulkan_sdk.tar.gz && rm -f vulkan_sdk.tar.gz
ENV VULKAN_SDK=/workspace/1.2.170.0/x86_64 LD_LIBRARY_PATH=/workspace/1.2.170.0/x86_64/lib VK_LAYER_PATH=/workspace/1.2.170.0/x86_64/etc/vulkan/explicit_layer.d PATH=/workspace/1.2.170.0/x86_64/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

WORKDIR /workspace
RUN git clone --single-branch -b 0.9.9.8 --depth 1 https://github.com/g-truc/glm.git
WORKDIR /workspace/glm
RUN cp -r glm /usr/local/include

RUN yum install -y glew-devel
ENV LD_LIBRARY_PATH=/opt/rh/devtoolset-9/root/usr/lib64:/opt/rh/devtoolset-9/root/usr/lib:/opt/rh/devtoolset-9/root/usr/lib64/dyninst:/opt/rh/devtoolset-9/root/usr/lib/dyninst:/opt/rh/devtoolset-9/root/usr/lib64:/opt/rh/devtoolset-9/root/usr/lib:/workspace/1.2.170.0/x86_64/lib PCP_DIR=/opt/rh/devtoolset-9/root DEVTOOLSET_ROOTPATH=/opt/rh/devtoolset-9/root MANPATH=/opt/rh/devtoolset-9/root/usr/share/man: PATH=/opt/rh/devtoolset-9/root/usr/bin:/workspace/1.2.170.0/x86_64/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

WORKDIR /workspace
RUN git clone --single-branch -b v2.1.0 --depth 1 https://github.com/yse/easy_profiler.git
RUN mkdir /workspace/easy_profiler/build
WORKDIR /workspace/easy_profiler/build
RUN cmake .. -DCMAKE_BUILD_TYPE=Release && make -j && make install

RUN yum install -y zip

WORKDIR /workspace
